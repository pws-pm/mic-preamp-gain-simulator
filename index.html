<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mic Preamp Gain Explorer</title>
  <link rel="stylesheet" href="styles.css" />
  <script defer src="app.js"></script>
</head>
<body>
  <div class="ambient"></div>
  <main class="app">
    <header class="hero">
      <div>
        <p class="eyebrow">Vocal Mic + Preamp Planning</p>
        <h1>Mic Preamp Gain Explorer</h1>
        <p class="subtitle">
          Dial your ADC headroom, preamp gain, and vocal SPL. See where each mic lands in dBFS before you build the pre.
        </p>
      </div>
      <div class="hero-metrics">
        <div class="metric">
          <span class="metric-label">ADC full-scale</span>
          <span class="metric-value" id="fsDbu">0.0 dBu</span>
        </div>
        <div class="metric">
          <span class="metric-label">Voice offset</span>
          <span class="metric-value" id="splOffset">0 dB</span>
        </div>
        <div class="metric">
          <span class="metric-label">Distance gain</span>
          <span class="metric-value" id="distanceGain">0 dB</span>
        </div>
        <div class="metric">
          <span class="metric-label">Total mics</span>
          <span class="metric-value" id="micCount">0</span>
        </div>
      </div>
    </header>

    <section class="layout">
      <aside class="panel controls">
        <h2>Controls</h2>

        <div class="control-group">
          <label for="adcDbu">ADC max input</label>
          <div class="control-inline">
            <input id="adcDbu" type="number" min="-6" max="30" step="0.5" value="15" />
            <span class="unit">dBu</span>
          </div>
          <p class="hint">Sets 0 dBFS. +15 dBu is a common ADC reference.</p>
        </div>

        <div class="control-group">
          <label for="gainDb">Preamp gain</label>
          <div class="control-inline">
            <input id="gainDb" type="number" min="-10" max="80" step="0.5" value="40" />
            <span class="unit">dB</span>
          </div>
          <input id="gainDbRange" type="range" min="-10" max="80" step="0.5" value="40" />
        </div>

        <div class="control-group">
          <label for="sensUnit">Sensitivity unit</label>
          <div class="control-inline">
            <select id="sensUnit">
              <option value="dBu">dBu</option>
              <option value="dBV">dBV</option>
              <option value="mV">mV</option>
            </select>
            <span class="unit">for mic sensitivity</span>
          </div>
        </div>

        <div class="control-group">
          <label for="splDb">Voice SPL at reference distance</label>
          <div class="control-inline">
            <input id="splDb" type="number" min="60" max="130" step="1" value="94" />
            <span class="unit">dB SPL</span>
          </div>
          <input id="splDbRange" type="range" min="60" max="130" step="1" value="94" />
          <div class="chip-row" id="splPresets">
            <button class="chip" data-spl="75">Quiet</button>
            <button class="chip" data-spl="85">Medium</button>
            <button class="chip" data-spl="100">Loud</button>
          </div>
          <p class="hint">Presets set SPL at the reference distance (30 cm).</p>
        </div>

        <div class="control-group">
          <label for="distanceCm">Distance to capsule</label>
          <div class="control-inline">
            <input id="distanceCm" type="number" min="2" max="60" step="1" value="30" />
            <span class="unit">cm</span>
          </div>
          <input id="distanceCmRange" type="range" min="2" max="60" step="1" value="30" />
          <p class="hint">Applies free-field inverse distance vs 30 cm reference.</p>
        </div>

        <div class="control-group">
          <label for="floorDbfs">Graph floor</label>
          <div class="control-inline">
            <input id="floorDbfs" type="number" min="-120" max="-20" step="1" value="-60" />
            <span class="unit">dBFS</span>
          </div>
          <p class="hint">Lower floor shows more headroom for quiet mics.</p>
        </div>

        <div class="control-group">
          <span class="label">Mic type filter</span>
          <div class="chip-row" id="typeFilters">
            <button class="chip active" data-type="all">All</button>
            <button class="chip" data-type="Dynamic">Dynamic</button>
            <button class="chip" data-type="Electret condenser">Electret condenser</button>
            <button class="chip" data-type="Externally polarized condenser">Externally polarized condenser</button>
            <button class="chip" data-type="Gooseneck">Gooseneck</button>
          </div>
        </div>
      </aside>

      <section class="results">
        <div class="view-tabs" id="viewTabs">
          <button class="tab active" data-view="meter" aria-pressed="true">Meter</button>
          <button class="tab" data-view="table" aria-pressed="false">Table</button>
          <button class="tab" data-view="database" aria-pressed="false">Database</button>
        </div>

        <section class="panel table-panel" data-view-panel="table" hidden>
          <div class="chart-header">
            <div>
              <h2>Numeric output table</h2>
              <p class="subtitle">Mic output includes SPL offset, distance gain, and preamp gain.</p>
            </div>
            <div class="legend">
              <span class="legend-dot ok"></span>
              <span>Safe</span>
              <span class="legend-dot warn"></span>
              <span>Near 0 dBFS</span>
              <span class="legend-dot clip"></span>
              <span>Clipping</span>
            </div>
          </div>

          <div class="table-wrap">
            <table class="mic-table">
              <thead>
                <tr>
                  <th>Mic</th>
                  <th>Type</th>
                  <th>Sensitivity (<span id="sensUnitLabelTable">dBu</span>)</th>
                  <th>Mic out</th>
                  <th>Preamp out</th>
                  <th>dBFS</th>
                </tr>
              </thead>
              <tbody id="micTable"></tbody>
            </table>
          </div>
        </section>

        <section class="panel meter-panel" data-view-panel="meter">
          <div class="chart-header">
            <div>
              <h2>dBFS meter view</h2>
              <p class="subtitle">Vertical meters show dBFS against 0 and the -18 dBFS target line.</p>
            </div>
            <div class="legend">
              <span class="legend-dot ok"></span>
              <span>Safe</span>
              <span class="legend-dot warn"></span>
              <span>Near 0 dBFS</span>
              <span class="legend-dot clip"></span>
              <span>Clipping</span>
            </div>
          </div>

          <div class="meter-area">
            <div class="meter-axis" id="meterAxis"></div>
            <div class="meter-plot" id="meterPlot">
              <div class="target-line" id="targetLine">
                <span>-18 dBFS</span>
              </div>
              <div class="meter-scroll">
                <div class="meter-bars" id="meterBars"></div>
              </div>
            </div>
          </div>
        </section>

        <section class="panel db-panel" data-view-panel="database" hidden>
          <div class="chart-header">
            <div>
              <h2>Microphone database</h2>
              <p class="subtitle">Add or remove mics. Sensitivities are stored and displayed in the selected unit.</p>
            </div>
          </div>

          <div class="table-wrap">
            <table class="mic-table db-table">
              <thead>
                <tr>
                  <th>Mic</th>
                  <th>Type</th>
                  <th>Sensitivity (<span id="sensUnitLabelDb">dBu</span>)</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody id="dbList"></tbody>
            </table>
          </div>

          <form class="db-form" id="addMicForm">
            <div class="db-field">
              <label for="addMicName">Mic name</label>
              <input id="addMicName" type="text" placeholder="New mic name" required />
            </div>
            <div class="db-field">
              <label for="addMicType">Type</label>
              <select id="addMicType">
                <option value="Dynamic">Dynamic</option>
                <option value="Electret condenser">Electret condenser</option>
                <option value="Externally polarized condenser">Externally polarized condenser</option>
              </select>
            </div>
            <div class="db-field">
              <label for="addMicSens">Sensitivity (<span id="sensUnitLabelForm">dBu</span>)</label>
              <input id="addMicSens" type="number" step="0.1" required />
            </div>
            <label class="db-check">
              <input id="addMicGooseneck" type="checkbox" />
              <span>Gooseneck</span>
            </label>
            <button class="primary" type="submit">Add mic</button>
          </form>
        </section>
      </section>
    </section>
  </main>
</body>
</html>
